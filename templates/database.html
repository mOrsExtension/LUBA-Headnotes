<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<html lang="en">
<head>
    <title>Headnote Database</title>
</head>
{% extends "base.html" %}

{% block content %}

<div class="search-controls">
    <div class="search-section">
        <h3>Text Search</h3>
        <form method="get" action="/{{ database }}/headnotes">
            <input type="text" name="_search" placeholder="Search all text fields..." class="search-text-box"
                value="{{ request.args.get('_search', '') }}">
            <input type="hidden" name="_sort" value="year">
            <button type="submit" class="submit-button">Search</button>
        </form>
    </div>
    <div class="search-section">
        <h3>SQL Search</h3>
        <form method="get" action="/{{ database }}">
            <textarea name="sql" class="sql-text-box" placeholder="Enter your SQL query here...">{{ request.args.get('sql', '') }}</textarea>
            <button type="submit" class="submit-button">Run Query</button>
        </form>
        {% include 'sql_help.html' %}
    </div>
</div>

{% if rows %}
    <div class="results-info">
        Showing {{ rows|length }} result{% if rows|length != 1 %}s{% endif %}
        {% if filtered_table_rows_count and filtered_table_rows_count != table_rows_count %}
        (filtered from {{ table_rows_count }} total)
        {% endif %}
    </div>

    {% from 'headnote_display.html' import render_headnote %}
    {% for row in rows %}
        {{ render_headnote(row, loop.index) }}
    {% endfor %}

{% else %}
    <div class="no-results">
        No headnotes found. Try adjusting your search terms.
    </div>
{% endif %}

<!-- No query, show welcome message -->
<div class="welcome">
    <p>Welcome to the LUBA Headnotes Database!</p>
    <p><a href="/{{ database }}/headnotes">Browse all headnotes</a> or use the search tools above.</p>
</div>
{% endblock %}
</html>
