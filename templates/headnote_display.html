<!DOCTYPE html>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<html lang="en">
<head>
    <title>Headnote Display</title>
</head>

{% macro render_headnote(row, loop_index) %}
    <div class="headnote-entry">
        <div class="headnote-header">
            <strong>Headnote:</strong> {{ row.headnote or row.headnote_number }}&nbsp;&nbsp;{{ row.topic }}
        </div>

        <div class="case-citation">
            {% if row.case_name %}
                {{ row.case_name }}{% if row.reporter and row.reporter != "" %}, {{ row.reporter }}{% endif %}{% if row.year %} ({{ row.year }}){% endif %}
            {% elif row.reporter %}
                [Name Missing]{{ row.reporter}}{% if row.year %} ({{ row.year }}){% endif %}
            {% elif row.year %}
                [Name and Reporter Missing] ({{ row.year }})
            {% else %}
                [Citation Incomplete]
            {% endif %}
        </div>

        <div class="summary">
            <strong>Summary:</strong>
            <span id="summary-{{ loop_index }}" class="formatted-text">{{ row.summary }}</span>
        </div>

        {% if row.opinion_pdf_url and row.opinion_pdf_url != "" %}
            <div class="opinion_link">
                <a href="{{ row.opinion_pdf_url }}">Opinion PDF from oregon.gov/luba/Docs</a>
            </div>
        {% endif %}

        <div class="metadata"><details>
            <summary>metadata:</summary>
            {% if row.year %}
                <div class="metadata-line"><strong>Opinion Date:</strong> {% if row.opinion_month %}{{ row.opinion_month }}-{% endif %}{{ row.year }}</div>
            {% endif %}

            {% if row.luba_no and row.luba_no != "" %}
                <div class="metadata-line"><strong>LUBA No.:</strong> {{ row.luba_no }}</div>
            {% endif %}

            {% if row.case_cites and row.case_cites != "[]" and row.case_cites != "" %}
                <div class="metadata-line"><strong>Case Cites:</strong> {{ row.case_cites|replace('[', '')|replace(']', '')|replace('"', '') }}</div>
            {% endif %}

            {% if row.ors_cites and row.ors_cites != "[]" and row.ors_cites != "" %}
                <div class="metadata-line"><strong>ORS Cites:</strong> {{ row.ors_cites|replace('[', '')|replace(']', '')|replace('"', '') }}</div>
            {% endif %}

            {% if row.oar_cites and row.oar_cites != "[]" and row.oar_cites != "" %}
                <div class="metadata-line"><strong>OAR Cites:</strong> {{ row.oar_cites|replace('[', '')|replace(']', '')|replace('"', '') }}</div>
            {% endif %}

            {% if row.opinion_matched_by and row.opinion_matched_by != "" %}
                <div class="metadata-line"><strong>Opinion Matched by:</strong> {{ row.opinion_matched_by}}</div>
            {% endif %}

            {% if row.index %}
                <div class="metadata-hide"><strong>Index:</strong> {{ row.index }}</div>
            {% endif %}
        </details>
        </div>

        {% if row.warnings and row.warnings != "[]" and row.warnings != "" %}
        <div class="error-notice">
            <strong>Warning:</strong> {{ row.warnings|replace('[', '')|replace(']', '')|replace('"', '') }}
        </div>
        {% endif %}

        <!-- Hidden formatting data for JavaScript -->
        {% if row.formatting %}
            <script type="application/json" class="formatting-data" data-target="summary-{{ loop_index }}">{{ row.formatting }}</script>
        {% endif %}
    </div>
{% endmacro %}

</html>
